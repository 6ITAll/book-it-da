import { http, HttpResponse } from 'msw';
import { FeedType, OneLinePost, Posting, PostType } from '@shared/types/type';
import { formatTimeAgo } from '@shared/utils/formatTimeAgo';

const mockPosts: (OneLinePost | Posting)[] = [
  {
    id: 1,
    imageUrl: '/src/assets/images/sample2.jpg',
    userName: 'user1',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 10,
    isLiked: false,
  },
  {
    id: 2,
    imageUrl: '/src/assets/images/sample1.jpg',
    userName: 'user2',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 20,
    isLiked: false,
  },
  {
    id: 3,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 4,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로워' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },
  {
    id: 5,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 6,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로워' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },
  {
    id: 7,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 8,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로워' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },
  {
    id: 9,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 10,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로워' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },
  {
    id: 11,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 12,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로워' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },
  {
    id: 13,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 14,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로워' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },
  {
    id: 15,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 16,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로워' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },
  {
    id: 17,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 18,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로워' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },
  {
    id: 19,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 20,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로워' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },
  {
    id: 21,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 22,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로워' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },
  {
    id: 23,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로워' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description: '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 24,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로워' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },
  {
    id: 25,
    imageUrl: '/src/assets/images/sample3.jpg',
    userName: 'user3',
    createdAt: '2025-01-02T11:04:08.842579',
    postType: '포스팅' as const,
    feedType: '팔로잉' as const,
    bookTitle: '책 제목 1',
    bookAuthor: '저자 1',
    title: '포스팅 제목 1',
    description:
      '포스팅 내용 1입니다. 이 책은 정말 흥미롭습니다. 이 책은 정말 흥미롭습니다. 이 책은 정말 흥미롭습니다. 이 책은 정말 흥미롭습니다.',
    likeCount: 30,
    isLiked: false,
  },
  {
    id: 26,
    imageUrl: '/src/assets/images/sample5.jpg',
    userName: 'user35',
    createdAt: '2025-01-01T19:40:36.434789',
    postType: '한줄평' as const,
    feedType: '팔로잉' as const,
    bookTitle: '밤의 사색',
    bookAuthor: '헤르만 헤세',
    likeCount: 723,
    isLiked: true,
    review: '이 책은 정말 흥미롭습니다. 리뷰 35',
  },

  // ... 나머지 포스트들
].map((post) => ({
  ...post,
  timeAgo: formatTimeAgo(post.createdAt),
}));

export const feedHandlers = [
  http.get('/api/posts', ({ request }) => {
    const url = new URL(request.url);
    const page = Number(url.searchParams.get('page')) || 1;
    const limit = Number(url.searchParams.get('limit')) || 10;
    const postType = url.searchParams.get('postType') as PostType | undefined;
    const feedType = url.searchParams.get('feedType') as FeedType;

    let filteredPosts = [...mockPosts];

    // postType 필터링 (선택된 경우에만)
    if (postType) {
      filteredPosts = filteredPosts.filter(
        (post) => post.postType === postType,
      );
    }

    // feedType 필터링
    if (feedType === '추천') {
      // '추천'일 때는 팔로워와 팔로잉 모두 포함
      filteredPosts = filteredPosts.filter(
        (post) => post.feedType === '팔로워' || post.feedType === '팔로잉',
      );
    } else {
      // 그 외에는 해당하는 feedType만 필터링
      filteredPosts = filteredPosts.filter(
        (post) => post.feedType === feedType,
      );
    }

    // 페이지네이션 적용
    const startIndex = (page - 1) * limit;
    const paginatedPosts = filteredPosts.slice(startIndex, startIndex + limit);

    const response = {
      posts: paginatedPosts.map((post) => ({
        ...post,
        timeAgo: formatTimeAgo(post.createdAt),
      })),
      hasMore: startIndex + limit < filteredPosts.length,
      totalCount: filteredPosts.length,
    };

    return HttpResponse.json(response);
  }),
];
